import React, {useReducer} from 'react';
import axios from 'axios';


import './App.css';
import {
  MDBContainer,
  MDBCol,
  MDBRow,
  MDBBtn,
  MDBIcon,
  MDBInput,
}
  from 'mdb-react-ui-kit';
import {API_URL} from "./config";
function App() {

  const initialState = {
    email: '',
    password: '',
    loading: false,
    error: null,
  };

  function reducer(state, action) {
    switch (action.type) {
      case 'SET_EMAIL':
        return {...state, email: action.payload};
      case 'SET_PASSWORD':
        return {...state, password: action.payload};
      default:
        return state;
    }}

  const [state, dispatch] = useReducer(reducer, initialState);


  const handleEmailChangeLogin = (event) => {
    dispatch({type: 'SET_EMAIL', payload: event.target.value});
  }

  const handlePasswordChangeLogin = (event) => {
    dispatch({type: 'SET_PASSWORD', payload: event.target.value});
  };

  const handleSubmitLogin = (event)=>{
    event.preventDefault();
    axios.post(`${API_URL}/login`, state , {withCredentials:true})
        .then(res=>{
          if(res.data==="Success"){
            window.location.href = '/'
          }
        })
        .catch((error) => {
          if (error.response && error.response.status === 401) {
            // Le serveur a répondu avec une erreur 401 (Unauthorized)
            //setLoginError(true); // Définissez l'état loginError sur true pour afficher le message d'erreur
          } else {
            console.error('Erreur lors de la connexion :', error);
          }
        });
  }



  return (
      <div className='center'>
        <MDBContainer fluid className="p-3 my-5">

          <MDBRow>

            <MDBCol col='10' md='6'>
              <img src="/mailarmor-logo.png" className="img-fluid" alt="logo"/>
            </MDBCol>

            <MDBCol col='4' md='6'>

              <form onSubmit={handleSubmitLogin}>
              <MDBInput
                  value={state.email}
                  onChange={handleEmailChangeLogin}
                  wrapperClass='mb-4'
                  label='Gmail address'
                  id='formControlLg'
                  type='email'
                  size="lg"
                  placeholder="Email"/>

              <MDBInput
                  value={state.password}
                  onChange={handlePasswordChangeLogin}
                  wrapperClass='mb-4'
                  label='Password'
                  id='formControlLg'
                  type='password'
                  size="lg"
                  placeholder="Password"/>

              <MDBBtn className="mb-4 w-100" size="lg">Analyze</MDBBtn>
                </form>

              <div className="divider d-flex align-items-center my-4">
                <p className="text-center fw-bold mx-3 mb-0">OR</p>
              </div>

              <MDBBtn className="mb-4 w-100" size="lg"
                  //style={{backgroundColor: 'blue'}}
              >
                <MDBIcon fab icon="facebook-f" className="mx-2"/>
                Continue with google
              </MDBBtn>


            </MDBCol>

          </MDBRow>

        </MDBContainer>
      </div>
  );
}

export default App;
